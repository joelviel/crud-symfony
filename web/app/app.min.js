function itemsFactory(e){return e.getService("/api/stocks")}function crudgridController(e,t,o,n,r,i,c){"use strict"
function l(){T=n.getService(e.serverUrl),B.columnsDefinition=angular.fromJson(o.columnsDefinition),B.getAllItems()}function a(){B.addMode=!B.addMode,B.newItem={},B.newItem.id=0,B.newItem.hasErrors=!E(B.newItem)}function u(e){e.editMode=!e.editMode,e.editMode?(e.serverValues=angular.toJson(e),B.allItems.forEach(function(t){e.id!=t.id&&t.editMode&&B.updateItem(t)})):D(e)}function s(e){E(e)&&T.save(e,function(e){B.allItems.unshift(e),B.addMode=!1,M(e)},function(e){w(e.data)})}function d(e){T.get({id:e},M,w)}function m(e){E(e)&&(e.editMode=!1,b(e)&&T.update({id:e.id},e,function(t){F(t,e),M()},function(t){w(t.data),D(e),e.editMode=!0}))}function f(e){var t=function(){return T["delete"]({id:e.id},e,function(){M()
var t=B.allItems.indexOf(e)
B.allItems.splice(t,1)},function(e){w(e.data)})},o="Delete '"+e.name+"'",n="Are you sure you want to remove this item?"
i.show(o,n,t)}function p(e){T["delete"]({id:e.id},e,function(){var t=B.allItems.indexOf(e)
B.allItems.splice(t,1)})}function v(){B.loading=!0,B.allItems=T.query(function(){B.loading=!1,e.initialized()&&e.initialized()(B)},function(){w("Error loading items.")})}function y(t,o){13==t.keyCode?(B.updateItem(o),t.target.blur()):S.run(function(){e.$apply(function(){o.hasErrors=!E(o)})})}function g(t,o){13==t.keyCode?(B.createItem(o),t.target.blur()):j.run(function(){e.$apply(function(){o.hasErrors=!E(o)})})}function I(e){B.orderByColumn==e?B.orderByReverse=!B.orderByReverse:(B.orderByColumn=e,B.orderByReverse=!1),U()}function C(t,o){e.columnButtonClick()&&e.columnButtonClick()(this,{button:t,item:o})}function h(e){var t=B.allItems.indexOf(e)
B.allItems.splice(t,1)}function x(e){B.allItems.unshift(e)}function $(){O.run(function(){e.$apply(function(){B.filter=B.filterText})})}function k(){B.filterText="",B.filter=""}function M(){r.success()}function w(e){r.error(e)}function E(e){var t=!0
return B.columnsDefinition.forEach(function(o){t&&"true"==o.required&&(t=void 0!=e[o.binding])}),t}function b(e){var t=angular.fromJson(e.serverValues),o=!1
return B.columnsDefinition.forEach(function(n){o||e[n.binding]==t[n.binding]||(o=!0)}),o}function D(e){var t=angular.fromJson(e.serverValues)
F(t,e),B.columnsDefinition.forEach(function(o){e[o.binding]=t[o.binding]})}function F(e,t){B.columnsDefinition.forEach(function(o){t[o.binding]=e[o.binding]})}function U(){B.allItems.sort(function(e,t){var o=0,n=e[B.orderByColumn],r=t[B.orderByColumn]
return null===n&&(n=""),null===r&&(r=""),r>n&&(o=-1),n>r&&(o=1),B.orderByReverse&&(o=-1*o),o})}var B=this
B.columnsDefinition=[],B.allItems=[],B.newItem={},B.loading=!1,B.addMode=!1,B.orderByColumn="",B.orderByReverse=!1,B.filter="",B.filterText="",B.initialize=l,B.toggleAddMode=a,B.toggleEditMode=u,B.createItem=s,B.readItem=d,B.updateItem=m,B.deleteItemWithConfirmation=f,B.deleteItem=p,B.getAllItems=v,B.updateModeKeyUp=y,B.createModeKeyUp=g,B.setOrderByColumn=I,B.notifyColumnClick=C,B.itemDeleted=h,B.itemCreated=x,B.filterChanged=$,B.clearFilter=k,B.initialize()
var T,j=c.getThrottle(500),S=c.getThrottle(500),O=c.getThrottle(500)}function ajaxServiceFactory(e){"use strict"
function t(t){if(""===t)throw"Invalid end point"
return e(t+"/:id",{id:"@Id"},{update:{method:"PUT"}})}this.getService=t}function cellEditorController(e){"use strict"
function t(e,t){n.keyUpEvent()(e,t)}function o(e){e.preventDefault(),e.stopPropagation(),n.datePickerOpen=!0}var n=this
n.keyUpEvent=e.keyUpEvent,n.column=e.column,n.item=e.item,n.today=new Date,n.datePickerOpen=!1,n.openDatePicker=o,n.fireKeyUpEvent=t}var stockModule=angular.module("stockModule",["ui.router","ui.bootstrap","ngResource","ui.utils.masks"])
stockModule.config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/items"),e.state("items",{url:"/items",views:{main:{templateUrl:"app/components/grid/data/dataView.html",controller:"itemsController as itemsCtrl"}}}).state("taxCalculator",{url:"/taxCalculator",views:{main:{templateUrl:"app/components/tax/taxView.html",controller:"taxCalculatorController as taxCalculatorCtrl"}}})}]).controller("navbarController",["$scope","$location",function(e,t){e.isActive=function(e){return t.path().indexOf(e)>-1}}]),stockModule.factory("notificationsFactory",function(){return toastr.options={showDuration:"100",hideDuration:"100",timeOut:"2000",positionClass:"toast-bottom-right",extendedTimeOut:"5000"},{success:function(e){void 0===e&&(e=""),toastr.success("Success. "+e)},error:function(e){void 0===e&&(e=""),toastr.error("Error. "+e)}}}),stockModule.factory("modalWindowFactory",["$modal",function(e){function t(e,t,o,n){e.title="",e.body="",o&&(e.title=o),n&&(e.body=n),e.confirm=function(){t.close()},e.cancel=function(){t.dismiss()}}var o=t
return t.$inject=["$scope","$modalInstance","title","body"],{show:function(t,n,r,i){var c=e.open({templateUrl:"app/shared/modalWindow/modalWindowView.html",controller:o,size:"sm",resolve:{title:function(){return t},body:function(){return n}}})
c.result.then(function(){void 0!=r&&r()},function(){void 0!=i&&i()})}}}]),function(){"use strict"
stockModule.factory("reactiveFactory",function(){function e(e){var t=null,o=e
return o||(o=250),{run:function(e){return function(){clearTimeout(t),t=setTimeout(function(){e.apply(),t=null},o)}()}}}return{getThrottle:e}})}(),function(){function e(e){function t(e){n.gridController=e}function o(t,o){console.log("button click"+o.button+" "+o.item.id),"plus"==o.button?e.show(o.item.name,"Custom button click = +"):"minus"==o.button&&e.show(o.item.name,"Custom button click = -")}var n=this
n.gridController={},n.gridOnButtonClick=o,n.gridOnInitialized=t,n.serverUrl="/api/stocks"}stockModule.controller("itemsController",e),e.$inject=["modalWindowFactory"]}(),stockModule.factory("itemsFactory",itemsFactory),itemsFactory.$inject=["ajaxServiceFactory"],stockModule.controller("crudgridController",crudgridController),crudgridController.$inject=["$scope","$element","$attrs","ajaxServiceFactory","notificationsFactory","modalWindowFactory","reactiveFactory"],stockModule.service("ajaxServiceFactory",ajaxServiceFactory),ajaxServiceFactory.$inject=["$resource"],stockModule.directive("crudGrid",function(){return{restrict:"A",replace:!1,scope:{columnButtonClick:"&",initialized:"&",serverUrl:"@serverUrl"},templateUrl:"app/components/grid/crud/crudView.html",controller:"crudgridController as itemsCtrl"}}),stockModule.controller("cellEditorController",cellEditorController),cellEditorController.$inject=["$scope"],stockModule.directive("cellEditor",function(){return{restrict:"A",replace:!0,scope:{column:"=",item:"=",keyUpEvent:"&"},templateUrl:"app/components/grid/crud/editor/editorView.html",controller:"cellEditorController as cellEditorCtrl"}}),stockModule.controller("taxCalculatorController",["$scope",function($scope){$scope.income=0,$scope.taxSystem=[{level:1,info:"5% from 0 to 50M IDR",minIncome:0,maxIncome:5e7,rate:.05},{level:2,info:"15% from 50M to 250M IDR",minIncome:5e7,maxIncome:25e7,rate:.15},{level:3,info:"25% from 250M to 500M IDR",minIncome:25e7,maxIncome:5e8,rate:.25},{level:4,info:"30% from 500M IDR",minIncome:5e8,maxIncome:1/0,rate:.3}],$scope.computeTaxes=function(){$scope.taxes=[],$scope.totalTaxes=0,angular.forEach($scope.taxSystem,function(e){$scope.income>e.minIncome&&$scope.taxes.push($scope.income<e.maxIncome?($scope.income-e.minIncome)*e.rate:(e.maxIncome-e.minIncome)*e.rate)}),$scope.totalTaxes=eval($scope.taxes.join("+"))}}])
